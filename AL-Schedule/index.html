<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Timetable</title>
  <style>
    :root{
      --bg:#0f1720; /* dark slate */
      --card:#0b1220;
      --accent:#60a5fa;
      --muted:rgba(255,255,255,0.18);
      --glass: rgba(255,255,255,0.03);
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#071023 0%, #071428 60%); color:#e6eef8}
    .wrap{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted)}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px;padding:16px;box-shadow:0 6px 24px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}

    .controls{display:flex;gap:16px;align-items:flex-start;margin-top:14px}
    .subjects{display:flex;flex-wrap:wrap;gap:8px;max-width:720px}
    .subjects label{display:flex;align-items:center;gap:8px;background:var(--glass);padding:6px 8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
    input[type=checkbox]{width:16px;height:16px}

    .actions{display:flex;gap:8px;align-items:center}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    button.primary{background:linear-gradient(90deg,var(--accent), #7dd3fc);color:#052033;border:none}

    /* Timetable table */
    .table-wrap{overflow:auto;margin-top:18px}
    table.timetable{border-collapse:collapse;width:100%;min-width:880px}
    table.timetable th, table.timetable td{border:1px solid rgba(255,255,255,0.04);padding:10px;text-align:center;vertical-align:middle}
    table.timetable th{background:rgba(255,255,255,0.02);font-weight:600}
    .slot-title{font-weight:700;margin-bottom:6px}
    .muted{opacity:0.18}
    .option{font-size:13px}
    .room{font-size:12px;color:var(--muted)}

    /* Hide columns when filtering */
    .hidden-column { display: none; }
    .hidden-row { display: none; }

    /* small screen adjustments */
    @media (max-width:760px){
      .controls{flex-direction:column}
      .subjects{max-width:100%}
      table.timetable{min-width:700px}
    }

    footer{margin-top:14px;color:var(--muted);font-size:13px}

    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Interactive Timetable</h1>
        <p class="lead">Pick subjects to highlight or *show only* the slots that contain them.</p>
      </div>
    </header>

    <div class="card">
      <div class="controls">
        <div>
          <strong>Subjects</strong>
          <div class="subjects" id="subjects"></div>
        </div>

        <div class="actions">
          <div style="display:flex;flex-direction:column;gap:8px">
            <label><input type="checkbox" id="persist"> <span style="margin-left:8px">Remember (local storage)<span></label>
          </div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-left:6px">
            <button id="selectAll">Select all</button>
            <button id="clearAll">Clear</button>
            <button id="exportJson">Export JSON</button>
          </div>
        </div>
      </div>

      <div class="table-wrap">
        <table class="timetable" id="timetable" aria-label="Weekly timetable">
          <!-- generated by JS -->
        </table>
      </div>
    </div>
  </div>

  <script>
    // Timetable data derived from the user's input
    const timetable = {
      days: ["Monday","Tuesday","Wednesday","Thursday","Friday"],
      periods: [1,2,3,4,5,6,7],
      // Each day: array of period objects {text: string, options: [{subject,room}], span: number}
      data: {
        Monday:[
          {options:[{subject:'Biology', room:'Lab'}], text:'Biology (Lab)'},
          {options:[{subject:'Business', room:'Room 11'}], text:'Business (Room 11)'},
          {options:[{subject:'French', room:'Room 11'},{subject:'History', room:'Room 12'}], text:'French (Room 11) or History (Room 12)'},
          {options:[{subject:'PE', room:'Gym'}], text:'PE (Gym)', span:2},
          // span used above covers 4 & 5
          {skip:true},
          {options:[{subject:'Math', room:'Room 3'},{subject:'English', room:'Library'}], text:'Math (Room 3) or English (Library)'},
          {options:[], text:''}
        ],
        Tuesday:[
          {options:[{subject:'French', room:'Room 12'},{subject:'English', room:'Library'}], text:'French (Room 12) or English (Library)'},
          {options:[{subject:'History', room:'Room 12'},{subject:'Chemistry', room:'Room 5'},{subject:'English',room:'Library'}], text:'History (Room 12) or Chemistry (Room 5) or English (Library)'},
          {options:[{subject:'Global Perspectives', room:'Library'},{subject:'Chemistry',room:'Room 5'}], text:'Global Perspectives (Library) or Chemistry (Room 5)'},
          {options:[{subject:'Biology',room:'Lab'},{subject:'Business',room:'Room 11'}], text:'Biology (Lab) or Business (Room 11)'},
          {options:[{subject:'Biology',room:'Lab'},{subject:'Business',room:'Room 11'}], text:'Biology (Lab) or Business (Room 11)'},
          {options:[{subject:'Biology',room:'Lab'},{subject:'Business',room:'Room 11'}], text:'Biology (Lab) or Business (Room 11)'},
          {options:[{subject:'French',room:'Mezzanine'},{subject:'Physics',room:'Room 11'}], text:'French (Mezzanine) or Physics (Room 11)'}
        ],
        Wednesday:[
          {options:[{subject:'Future Technologies',room:'Art Room'}], text:'Future Technologies (Art Room)'},
          {options:[{subject:'Math',room:'Room 3'}], text:'Math (Room 3)'},
          {options:[{subject:'Physics',room:'Library'},{subject:'English',room:'Room 11'}], text:'Physics (Library) or English (Room 11)'},
          {options:[{subject:'Global Perspectives',room:'Library'},{subject:'Chemistry',room:'Lab'}], text:'Global Perspectives (Library) or Chemistry (Lab)'},
          {options:[{subject:'History',room:'Mezzanine'},{subject:'Chemistry',room:'Lab'}], text:'History (Mezzanine) or Chemistry (Lab)'},
          {options:[{subject:'History',room:'Mezzanine'},{subject:'French',room:'Room 5'},{subject:'Physics',room:'Lab'}], text:'History (Mezzanine) or French (Room 5) or Physics (Lab)'},
          {options:[{subject:'French',room:'Room 5'},{subject:'Physics',room:'Lab'}], text:'French (Room 5) or Physics (Lab)'}
        ],
        Thursday:[
          {options:[{subject:'Math',room:'Library'},{subject:'History',room:'Room 12'}], text:'Math (Library) or History (Room 12)'},
          {options:[{subject:'Biology',room:'Room 9'},{subject:'Business',room:'Room 11'}], text:'Biology (Room 9) or Business (Room 11)'},
          {options:[{subject:'French',room:'Room 11'},{subject:'Physics',room:'Room 12'}], text:'French (Room 11) or Physics (Room 12)'},
          {options:[{subject:'Global Perspectives',room:'Mezzanine'},{subject:'Chemistry',room:'Room 5'}], text:'Global Perspectives (Mezzanine) or Chemistry (Room 5)'},
          {options:[{subject:'English',room:'Art Room'}], text:'English (Art Room)'},
          {options:[{subject:'Math',room:'Mezzanine'},{subject:'History',room:'Room 12'}], text:'Math (Mezzanine) or History (Room 12)'},
          {options:[{subject:'Physics',room:'Room 2'}], text:'Physics (Room 2)'}
        ],
        Friday:[
          {options:[{subject:'Biology',room:'Room 3'},{subject:'Business',room:'Room 11'}], text:'Biology (Room 3) or Business (Room 11)'},
          {options:[{subject:'Math',room:'Mezzanine'}], text:'Math (Mezzanine)'},
          {options:[{subject:'PSHE',room:'Room 11'}], text:'PSHE (Room 11)'},
          {options:[{subject:'Critical Curriculum',room:'Depends'}], text:'Critical Curriculum (Depends)', span:2},
          {skip:true},
          {options:[{subject:'Global Perspectives',room:'Library'},{subject:'Chemistry',room:'Room 5'}], text:'Global Perspectives (Library) or Chemistry (Room 5)'},
          {options:[{subject:'Math',room:'Room 3'}], text:'Math (Room 3)'}
        ]
      }
    };

    // Build subject list from data
    function gatherSubjects(){
      const s = new Set();
      for(const day of timetable.days){
        const arr = timetable.data[day];
        for(const p of arr){
          if(p && p.options) p.options.forEach(o=>s.add(o.subject));
        }
      }
      return Array.from(s).sort();
    }

    const subjects = gatherSubjects();

    // Render subject checkboxes
    const subjectsContainer = document.getElementById('subjects');
    subjects.forEach(sub=>{
      const id = 'sb-'+sub.replace(/\s+/g,'-');
      const lbl = document.createElement('label');
      lbl.innerHTML = `<input type='checkbox' data-sub='${sub}' id='${id}'><span style='margin-left:4px'>${sub}</span>`;
      subjectsContainer.appendChild(lbl);
    });

    // persist toggle and controls
    const persistCheckbox = document.getElementById('persist');
    const selectAllBtn = document.getElementById('selectAll');
    const clearAllBtn = document.getElementById('clearAll');
    const exportJsonBtn = document.getElementById('exportJson');

    function getSelectedSubjects(){
      const checked = [...document.querySelectorAll('#subjects input[type=checkbox]:checked')].map(i=>i.dataset.sub);
      return checked;
    }

    function applyFromLocal(){
      try{
        const raw = localStorage.getItem('tt.selected');
        const p = localStorage.getItem('tt.persist');
        if(p==='1') persistCheckbox.checked = true;
        if(raw){
          const arr = JSON.parse(raw);
          if(Array.isArray(arr)){
            document.querySelectorAll('#subjects input[type=checkbox]').forEach(i=>{ i.checked = arr.includes(i.dataset.sub); });
          }
        }
      }catch(e){console.warn(e)}
    }

    // Build table with support for rowspan and skips
    function buildTable(){
      const table = document.getElementById('timetable');
      table.innerHTML = '';
      const thead = document.createElement('thead');
      const tr = document.createElement('tr');
      tr.appendChild(Object.assign(document.createElement('th'),{innerText:'Period'}));
      for(let dayIndex = 0; dayIndex < timetable.days.length; dayIndex++){
        const th = document.createElement('th'); 
        th.innerText = timetable.days[dayIndex]; 
        th.dataset.dayIndex = dayIndex;
        tr.appendChild(th);
      }
      thead.appendChild(tr); table.appendChild(thead);

      const tbody = document.createElement('tbody');

      for(let pIndex=0;pIndex<timetable.periods.length;pIndex++){
        const period = timetable.periods[pIndex];
        const tr = document.createElement('tr');
        tr.dataset.periodIndex = pIndex;
        tr.appendChild(Object.assign(document.createElement('td'),{innerText:period, style:'font-weight:700; width:64px'}));

        for(let dayIndex = 0; dayIndex < timetable.days.length; dayIndex++){
          const d = timetable.days[dayIndex];
          const dayArr = timetable.data[d];
          const cellObj = dayArr[pIndex];
          if(!cellObj){ // fallback empty
            const td = document.createElement('td');
            td.dataset.dayIndex = dayIndex;
            td.dataset.subjects = JSON.stringify([]);
            tr.appendChild(td);
            continue;
          }
          if(cellObj.skip){
            // skip slot because previous cell spanned into this row
            continue;
          }
          const td = document.createElement('td');
          td.dataset.dayIndex = dayIndex;

          const span = cellObj.span||1;
          if(span>1) td.rowSpan = span;

          // create inner content - only show the options, not the redundant text
          const opts = document.createElement('div');
          opts.className='options';
          if(cellObj.options && cellObj.options.length){
            cellObj.options.forEach(o=>{
              const dEl = document.createElement('div');
              dEl.className='option';
              dEl.innerHTML = `<strong>${o.subject}</strong> <span class='room'>${o.room||''}</span>`;
              opts.appendChild(dEl);
            });
          } else if(cellObj.text) {
            // Handle cells with text but no structured options (like empty slots)
            const dEl = document.createElement('div');
            dEl.className='option';
            dEl.innerHTML = cellObj.text;
            opts.appendChild(dEl);
          }
          td.appendChild(opts);
          td.dataset.subjects = JSON.stringify((cellObj.options||[]).map(o=>o.subject));

          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      }

      table.appendChild(tbody);
      refreshFilter();
    }

    function refreshFilter(){
      const selected = getSelectedSubjects();
      const anySelected = selected.length > 0;
      
      // Simple highlight mode - show everything but highlight matches
      document.querySelectorAll('#timetable td[data-subjects]').forEach(td => {
        const subjects = JSON.parse(td.dataset.subjects || '[]');
        const intersects = subjects.some(s => selected.includes(s));
        
        td.classList.remove('muted');
        td.style.boxShadow = '';
        
        if(anySelected && intersects) {
          td.style.boxShadow = '0 6px 18px rgba(96,165,250,0.06)';
        } else if(anySelected && !intersects) {
          td.classList.add('muted');
        }
      });

      // optional: persist selection
      if(persistCheckbox.checked){
        try{ localStorage.setItem('tt.selected', JSON.stringify(getSelectedSubjects())); localStorage.setItem('tt.persist','1'); }catch(e){}
      } else { try{ localStorage.removeItem('tt.persist'); }catch(e){} }
    }

    // wire events
    document.querySelectorAll('#subjects input[type=checkbox]').forEach(i=>{
      i.addEventListener('change', ()=>{ refreshFilter(); });
    });
    persistCheckbox.addEventListener('change', ()=>{
      if(!persistCheckbox.checked) localStorage.removeItem('tt.selected'); else localStorage.setItem('tt.selected', JSON.stringify(getSelectedSubjects()));
    });
    selectAllBtn.addEventListener('click', ()=>{ document.querySelectorAll('#subjects input[type=checkbox]').forEach(i=>i.checked=true); refreshFilter(); });
    clearAllBtn.addEventListener('click', ()=>{ document.querySelectorAll('#subjects input[type=checkbox]').forEach(i=>i.checked=false); refreshFilter(); });
    exportJsonBtn.addEventListener('click', ()=>{
      const data = {timetable, selected:getSelectedSubjects()};
      const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='timetable.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    // init
    applyFromLocal(); buildTable();

    // small accessibility: keyboard shortcut 'f' to focus first checkbox
    window.addEventListener('keydown', e=>{ if(e.key==='f') document.querySelector('#subjects input')?.focus(); });
  </script>
</body>
</html>
